<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Process (eio.Eio.Process)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">eio</a> &#x00BB; <a href="../index.html">Eio</a> &#x00BB; Process</nav><header class="odoc-preamble"><h1>Module <code><span>Eio.Process</span></code></h1><p>Managing child processes.</p><p>Example:</p><pre class="language-ocaml"><code># Eio_main.run @@ fun env -&gt;
  let proc_mgr = Eio.Stdenv.process_mgr env in
  Eio.Process.parse_out proc_mgr Eio.Buf_read.line [&quot;echo&quot;; &quot;hello&quot;]</code></pre></header><nav class="odoc-toc"><ul><li><a href="#status-and-error-types">Status and error types</a></li><li><a href="#types">Types</a></li><li><a href="#processes">Processes</a></li><li><a href="#pipes">Pipes</a></li></ul></nav><div class="odoc-content"><h3 id="status-and-error-types"><a href="#status-and-error-types" class="anchor"></a>Status and error types</h3><div class="odoc-spec"><div class="spec type anchored" id="type-exit_status"><a href="#type-exit_status" class="anchor"></a><code><span><span class="keyword">type</span> exit_status</span><span> = </span><span>[ </span></code><ol><li id="type-exit_status.Exited" class="def variant constructor anchored"><a href="#type-exit_status.Exited" class="anchor"></a><code><span>| </span><span>`Exited <span class="keyword">of</span> int</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Process exited with the given return code.</p><span class="comment-delim">*)</span></div></li><li id="type-exit_status.Signaled" class="def variant constructor anchored"><a href="#type-exit_status.Signaled" class="anchor"></a><code><span>| </span><span>`Signaled <span class="keyword">of</span> int</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Process was killed by the given signal.</p><span class="comment-delim">*)</span></div></li></ol><code><span> ]</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-status"><a href="#type-status" class="anchor"></a><code><span><span class="keyword">type</span> status</span><span> = </span><span>[ </span></code><ol><li id="type-status.exit_status" class="def variant type anchored"><a href="#type-status.exit_status" class="anchor"></a><code><span>| </span><span><a href="#type-exit_status">exit_status</a></span></code></li><li id="type-status.Stopped" class="def variant constructor anchored"><a href="#type-status.Stopped" class="anchor"></a><code><span>| </span><span>`Stopped <span class="keyword">of</span> int</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Process was stopped (paused) by the given signal.</p><span class="comment-delim">*)</span></div></li></ol><code><span> ]</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_status"><a href="#val-pp_status" class="anchor"></a><code><span><span class="keyword">val</span> pp_status : <span><span>[&lt; <a href="#type-status">status</a> ]</span> <span class="xref-unresolved">Fmt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-error"><a href="#type-error" class="anchor"></a><code><span><span class="keyword">type</span> error</span><span> = </span></code><ol><li id="type-error.Executable_not_found" class="def variant constructor anchored"><a href="#type-error.Executable_not_found" class="anchor"></a><code><span>| </span><span><span class="constructor">Executable_not_found</span> <span class="keyword">of</span> string</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The requested executable does not exist.</p><span class="comment-delim">*)</span></div></li><li id="type-error.Child_error" class="def variant constructor anchored"><a href="#type-error.Child_error" class="anchor"></a><code><span>| </span><span><span class="constructor">Child_error</span> <span class="keyword">of</span> <a href="#type-exit_status">exit_status</a></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The process exited with an error status.</p><span class="comment-delim">*)</span></div></li></ol></div></div><div class="odoc-spec"><div class="spec type extension anchored" id="extension-decl-E"><a href="#extension-decl-E" class="anchor"></a><code><span><span class="keyword">type</span> <a href="../Exn/index.html#type-err">Exn.err</a> += </span></code><ol><li id="extension-E" class="def variant extension anchored"><a href="#extension-E" class="anchor"></a><code><span>| </span><span><span class="extension">E</span> <span class="keyword">of</span> <a href="#type-error">error</a></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-err"><a href="#val-err" class="anchor"></a><code><span><span class="keyword">val</span> err : <span><a href="#type-error">error</a> <span class="arrow">&#45;&gt;</span></span> exn</span></code></div><div class="spec-doc"><p><code>err e</code> is <code>Eio.Exn.create (E e)</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_args"><a href="#val-pp_args" class="anchor"></a><code><span><span class="keyword">val</span> pp_args : <span><span>string list</span> <span class="xref-unresolved">Fmt</span>.t</span></span></code></div><div class="spec-doc"><p>Formats a list of arguments, quoting any that might cause confusion to the reader.</p><p>This is intended for use in error messages and logging.</p></div></div><h3 id="types"><a href="#types" class="anchor"></a>Types</h3><div class="odoc-spec"><div class="spec type anchored" id="type-ty"><a href="#type-ty" class="anchor"></a><code><span><span class="keyword">type</span> <span>'tag ty</span></span><span> = </span><span>[ </span></code><ol><li id="type-ty.Process" class="def variant constructor anchored"><a href="#type-ty.Process" class="anchor"></a><code><span>| </span><span>`Process</span></code></li><li id="type-ty.Platform" class="def variant constructor anchored"><a href="#type-ty.Platform" class="anchor"></a><code><span>| </span><span>`Platform <span class="keyword">of</span> <span class="type-var">'tag</span></span></code></li></ol><code><span> ]</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a t</span></span><span> = <span><span>[&gt; <span><span>[&gt; `Generic ]</span> <a href="#type-ty">ty</a></span> ]</span> <span class="keyword">as</span> 'a <a href="../Std/index.html#type-r">Std.r</a></span></span></code></div><div class="spec-doc"><p>A process.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-mgr_ty"><a href="#type-mgr_ty" class="anchor"></a><code><span><span class="keyword">type</span> <span>'tag mgr_ty</span></span><span> = </span><span>[ </span></code><ol><li id="type-mgr_ty.Process_mgr" class="def variant constructor anchored"><a href="#type-mgr_ty.Process_mgr" class="anchor"></a><code><span>| </span><span>`Process_mgr</span></code></li><li id="type-mgr_ty.Platform" class="def variant constructor anchored"><a href="#type-mgr_ty.Platform" class="anchor"></a><code><span>| </span><span>`Platform <span class="keyword">of</span> <span class="type-var">'tag</span></span></code></li></ol><code><span> ]</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-mgr"><a href="#type-mgr" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a mgr</span></span><span> = <span><span class="type-var">'a</span> <a href="../Std/index.html#type-r">Std.r</a></span></span><span> <span class="keyword">constraint</span> <span class="type-var">'a</span> = <span>[&gt; <span><span>[&gt; `Generic ]</span> <a href="#type-mgr_ty">mgr_ty</a></span> ]</span></span></code></div><div class="spec-doc"><p>A process manager capable of spawning new processes.</p></div></div><h3 id="processes"><a href="#processes" class="anchor"></a>Processes</h3><div class="odoc-spec"><div class="spec value anchored" id="val-pid"><a href="#val-pid" class="anchor"></a><code><span><span class="keyword">val</span> pid : <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>pid t</code> is the process ID of <code>t</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-await"><a href="#val-await" class="anchor"></a><code><span><span class="keyword">val</span> await : <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-exit_status">exit_status</a></span></code></div><div class="spec-doc"><p><code>await t</code> waits for process <code>t</code> to exit and then reports the status.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-await_exn"><a href="#val-await_exn" class="anchor"></a><code><span><span class="keyword">val</span> await_exn : <span><span class="optlabel">?is_success</span>:<span>(<span>int <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Like <a href="#val-await"><code>await</code></a> except an exception is raised if does not return a successful exit status.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">is_success</span> <p>Used to determine if an exit code is successful. Default is <code>Int.equal 0</code>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-signal"><a href="#val-signal" class="anchor"></a><code><span><span class="keyword">val</span> signal : <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>signal t i</code> sends the signal <code>i</code> to process <code>t</code>.</p><p>If the process has already exited then this does nothing (it will not signal a different process, even if the PID has been reused).</p><p>See <code>Sys</code> for the signal numbers.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-spawn"><a href="#val-spawn" class="anchor"></a><code><span><span class="keyword">val</span> spawn : 
  <span><span class="label">sw</span>:<a href="../Switch/index.html#type-t">Switch.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>[&gt; <span><span class="type-var">'tag</span> <a href="#type-mgr_ty">mgr_ty</a></span> ]</span> <a href="../Std/index.html#type-r">Std.r</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?cwd</span>:<span><a href="../Fs/index.html#type-dir_ty">Fs.dir_ty</a> <a href="../Path/index.html#type-t">Path.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?stdin</span>:<span><span class="type-var">_</span> <a href="../Flow/index.html#type-source">Flow.source</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?stdout</span>:<span><span class="type-var">_</span> <a href="../Flow/index.html#type-sink">Flow.sink</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?stderr</span>:<span><span class="type-var">_</span> <a href="../Flow/index.html#type-sink">Flow.sink</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?env</span>:<span>string array</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?executable</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'tag</span> <a href="#type-ty">ty</a></span> <a href="../Std/index.html#type-r">Std.r</a></span></span></code></div><div class="spec-doc"><p><code>spawn ~sw mgr args</code> creates a new child process that is connected to the switch <code>sw</code>.</p><p>The child process will be sent <code>Sys.sigkill</code> when the switch is released.</p><p>If the flows <code>stdin</code>, <code>stdout</code> and <code>stderr</code> are not backed by file descriptors then this also creates pipes and spawns fibers to copy the data as necessary. If you need more control over file descriptors, see <a href="../../Eio_unix/Process/index.html"><code>Eio_unix.Process</code></a>.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">cwd</span> <p>The current working directory of the process (default: same as parent process).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">stdin</span> <p>The flow to attach to the process's standard input (default: same as parent process).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">stdout</span> <p>A flow that the process's standard output goes to (default: same as parent process).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">stderr</span> <p>A flow that the process's standard error goes to (default: same as parent process).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">env</span> <p>The environment for the process (default: same as parent process).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">executable</span> <p>The path of the executable to run. If not given then the first item in <code>args</code> is used, searching $PATH for it if necessary.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run"><a href="#val-run" class="anchor"></a><code><span><span class="keyword">val</span> run : 
  <span><span><span class="type-var">_</span> <a href="#type-mgr">mgr</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?cwd</span>:<span><span class="type-var">_</span> <a href="../Path/index.html#type-t">Path.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?stdin</span>:<span><span class="type-var">_</span> <a href="../Flow/index.html#type-source">Flow.source</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?stdout</span>:<span><span class="type-var">_</span> <a href="../Flow/index.html#type-sink">Flow.sink</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?stderr</span>:<span><span class="type-var">_</span> <a href="../Flow/index.html#type-sink">Flow.sink</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?is_success</span>:<span>(<span>int <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?env</span>:<span>string array</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?executable</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>run</code> does <a href="#val-spawn"><code>spawn</code></a> followed by <a href="#val-await_exn"><code>await_exn</code></a>, with the advantage that if the process fails then the error message includes the command that failed.</p><p>When <code>is_success</code> is provided, it is called with the exit code to determine whether it indicates success or failure. Without <code>is_success</code>, success requires the process to return an exit code of 0.</p><p>Note: If <code>spawn</code> needed to create extra fibers to copy <code>stdin</code>, etc, then it also waits for those to finish.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-parse_out"><a href="#val-parse_out" class="anchor"></a><code><span><span class="keyword">val</span> parse_out : 
  <span><span><span class="type-var">_</span> <a href="#type-mgr">mgr</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../Buf_read/index.html#type-parser">Buf_read.parser</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?cwd</span>:<span><span class="type-var">_</span> <a href="../Path/index.html#type-t">Path.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?stdin</span>:<span><span class="type-var">_</span> <a href="../Flow/index.html#type-source">Flow.source</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?stderr</span>:<span><span class="type-var">_</span> <a href="../Flow/index.html#type-sink">Flow.sink</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?is_success</span>:<span>(<span>int <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?env</span>:<span>string array</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?executable</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>parse_out mgr parser args</code> runs <code>args</code> and parses the child's stdout with <code>parser</code>.</p><p>It also waits for the process to finish and checks its exit status is zero.</p><p>Note that <code>parser</code> must consume the entire output of the process (like <a href="../Buf_read/index.html#val-parse"><code>Buf_read.parse</code></a>).</p><p>To return all the output as a string, use <a href="../Buf_read/index.html#val-take_all"><code>Buf_read.take_all</code></a> as the parser.</p><p>This is a convenience wrapper around <a href="#val-run"><code>run</code></a>, and the optional arguments have the same meanings.</p></div></div><h3 id="pipes"><a href="#pipes" class="anchor"></a>Pipes</h3><div class="odoc-spec"><div class="spec value anchored" id="val-pipe"><a href="#val-pipe" class="anchor"></a><code><span><span class="keyword">val</span> pipe : 
  <span><span class="label">sw</span>:<a href="../Switch/index.html#type-t">Switch.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">_</span> <a href="#type-mgr">mgr</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>[ <a href="../Flow/index.html#type-source_ty">Flow.source_ty</a> <span>| <a href="../Resource/index.html#type-close_ty">Resource.close_ty</a></span> ]</span> <a href="../Std/index.html#type-r">Std.r</a></span>
  * <span><span>[ <a href="../Flow/index.html#type-sink_ty">Flow.sink_ty</a> <span>| <a href="../Resource/index.html#type-close_ty">Resource.close_ty</a></span> ]</span> <a href="../Std/index.html#type-r">Std.r</a></span></span></code></div><div class="spec-doc"><p><code>pipe ~sw mgr</code> creates a pipe backed by the OS.</p><p>The flows can be used by <a href="#val-spawn"><code>spawn</code></a> without the need for extra fibers to copy the data. This can be used to connect multiple processes together.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Pi"><a href="#module-Pi" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Pi/index.html">Pi</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div></body></html>
