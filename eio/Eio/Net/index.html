<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Net (eio.Eio.Net)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">eio</a> &#x00BB; <a href="../index.html">Eio</a> &#x00BB; Net</nav><header class="odoc-preamble"><h1>Module <code><span>Eio.Net</span></code></h1><p>Networking.</p><p>Example:</p><pre><code>let addr = `Tcp (Ipaddr.V4.loopback, 8080)

let http_get ~net ~stdout addr =
  Switch.run @@ fun sw -&gt;
  let flow = Net.connect ~sw net addr in
  Flow.copy_string &quot;GET / HTTP/1.0\r\n\r\n&quot; flow;
  Flow.shutdown flow `Send;
  Flow.copy flow stdout</code></pre></header><nav class="odoc-toc"><ul><li><a href="#provider-interfaces">Provider Interfaces</a></li><li><a href="#out-bound-connections">Out-bound Connections</a></li><li><a href="#incoming-connections">Incoming Connections</a></li><li><a href="#datagram-sockets">Datagram Sockets</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec exception" id="exception-Connection_reset" class="anchored"><a href="#exception-Connection_reset" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Connection_reset</span> <span class="keyword">of</span> exn</span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Ipaddr" class="anchored"><a href="#module-Ipaddr" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Ipaddr/index.html">Ipaddr</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>IP addresses.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Sockaddr" class="anchored"><a href="#module-Sockaddr" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Sockaddr/index.html">Sockaddr</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Network addresses.</p></div></div><h3 id="provider-interfaces"><a href="#provider-interfaces" class="anchor"></a>Provider Interfaces</h3><div class="odoc-spec"><div class="spec class" id="class-socket" class="anchored"><a href="#class-socket" class="anchor"></a><code><span><span class="keyword">class</span> <span class="keyword">virtual</span>  </span><span><a href="class-socket/index.html">socket</a></span><span> : <span class="keyword">object</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec class" id="class-stream_socket" class="anchored"><a href="#class-stream_socket" class="anchor"></a><code><span><span class="keyword">class</span> <span class="keyword">virtual</span>  </span><span><a href="class-stream_socket/index.html">stream_socket</a></span><span> : <span class="keyword">object</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec class" id="class-datagram_socket" class="anchored"><a href="#class-datagram_socket" class="anchor"></a><code><span><span class="keyword">class</span> <span class="keyword">virtual</span>  </span><span><a href="class-datagram_socket/index.html">datagram_socket</a></span><span> : <span class="keyword">object</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec class" id="class-listening_socket" class="anchored"><a href="#class-listening_socket" class="anchor"></a><code><span><span class="keyword">class</span> <span class="keyword">virtual</span>  </span><span><a href="class-listening_socket/index.html">listening_socket</a></span><span> : <span class="keyword">object</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec class" id="class-t" class="anchored"><a href="#class-t" class="anchor"></a><code><span><span class="keyword">class</span> <span class="keyword">virtual</span>  </span><span><a href="class-t/index.html">t</a></span><span> : <span class="keyword">object</span> ... <span class="keyword">end</span></span></code></div></div><h3 id="out-bound-connections"><a href="#out-bound-connections" class="anchor"></a>Out-bound Connections</h3><div class="odoc-spec"><div class="spec value" id="val-connect" class="anchored"><a href="#val-connect" class="anchor"></a><code><span><span class="keyword">val</span> connect : <span>sw:<a href="../Switch/index.html#type-t">Switch.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="class-t/index.html">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Sockaddr/index.html#type-stream">Sockaddr.stream</a> <span class="arrow">&#45;&gt;</span></span> <a href="class-stream_socket/index.html">stream_socket</a></span></code></div><div class="spec-doc"><p><code>connect ~sw t addr</code> is a new socket connected to remote address <code>addr</code>.</p><p>The new socket will be closed when <code>sw</code> finishes, unless closed manually first.</p></div></div><h3 id="incoming-connections"><a href="#incoming-connections" class="anchor"></a>Incoming Connections</h3><div class="odoc-spec"><div class="spec value" id="val-listen" class="anchored"><a href="#val-listen" class="anchor"></a><code><span><span class="keyword">val</span> listen : 
  <span>?reuse_addr:bool <span class="arrow">&#45;&gt;</span></span>
  <span>?reuse_port:bool <span class="arrow">&#45;&gt;</span></span>
  <span>backlog:int <span class="arrow">&#45;&gt;</span></span>
  <span>sw:<a href="../Switch/index.html#type-t">Switch.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="class-t/index.html">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="Sockaddr/index.html#type-stream">Sockaddr.stream</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="class-listening_socket/index.html">listening_socket</a></span></code></div><div class="spec-doc"><p><code>listen ~sw ~backlog t addr</code> is a new listening socket bound to local address <code>addr</code>.</p><p>The new socket will be closed when <code>sw</code> finishes, unless closed manually first.</p><p>For (non-abstract) Unix domain sockets, the path will be removed afterwards.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">backlog</span> <p>The number of pending connections that can be queued up (see listen(2)).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">reuse_addr</span> <p>Set the <code>Unix</code>.SO_REUSEADDR socket option. For Unix paths, also remove any stale left-over socket.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">reuse_port</span> <p>Set the <code>Unix</code>.SO_REUSEPORT socket option.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-accept" class="anchored"><a href="#val-accept" class="anchor"></a><code><span><span class="keyword">val</span> accept : <span>sw:<a href="../Switch/index.html#type-t">Switch.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="class-listening_socket/index.html">listening_socket</a> <span class="arrow">&#45;&gt;</span></span> <a href="class-stream_socket/index.html">stream_socket</a> * <a href="Sockaddr/index.html#type-stream">Sockaddr.stream</a></span></code></div><div class="spec-doc"><p><code>accept ~sw socket</code> waits until a new connection is ready on <code>socket</code> and returns it.</p><p>The new socket will be closed automatically when <code>sw</code> finishes, if not closed earlier. If you want to handle multiple connections, consider using <a href="#val-accept_sub"><code>accept_sub</code></a> instead.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-accept_sub" class="anchored"><a href="#val-accept_sub" class="anchor"></a><code><span><span class="keyword">val</span> accept_sub : 
  <span>sw:<a href="../Switch/index.html#type-t">Switch.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="class-listening_socket/index.html">listening_socket</a> <span class="arrow">&#45;&gt;</span></span>
  <span>on_error:<span>( <span>exn <span class="arrow">&#45;&gt;</span></span> unit )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span>sw:<a href="../Switch/index.html#type-t">Switch.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="class-stream_socket/index.html">stream_socket</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Sockaddr/index.html#type-stream">Sockaddr.stream</a> <span class="arrow">&#45;&gt;</span></span> unit )</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>accept socket fn</code> accepts a connection and handles it in a new fiber.</p><p>After accepting a connection to <code>socket</code>, it runs <code>fn ~sw flow client_addr</code> in a new fiber, using <a href="../Fiber/index.html#val-fork_on_accept"><code>Fiber.fork_on_accept</code></a>.</p><p><code>flow</code> will be closed automatically when the sub-switch is finished, if not already closed by then.</p></div></div><h3 id="datagram-sockets"><a href="#datagram-sockets" class="anchor"></a>Datagram Sockets</h3><div class="odoc-spec"><div class="spec value" id="val-datagram_socket" class="anchored"><a href="#val-datagram_socket" class="anchor"></a><code><span><span class="keyword">val</span> datagram_socket : <span>sw:<a href="../Switch/index.html#type-t">Switch.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="class-t/index.html">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Sockaddr/index.html#type-datagram">Sockaddr.datagram</a> <span class="arrow">&#45;&gt;</span></span> <a href="class-datagram_socket/index.html">datagram_socket</a></span></code></div><div class="spec-doc"><p><code>datagram_socket ~sw t addr</code> creates a new datagram socket that data can be sent to and received from. The new socket will be closed when <code>sw</code> finishes.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-send" class="anchored"><a href="#val-send" class="anchor"></a><code><span><span class="keyword">val</span> send : <span><a href="class-datagram_socket/index.html">datagram_socket</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Sockaddr/index.html#type-datagram">Sockaddr.datagram</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Cstruct</span>.t <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>send sock addr buf</code> sends the data in <code>buf</code> to the address <code>addr</code> using the the datagram socket <code>sock</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-recv" class="anchored"><a href="#val-recv" class="anchor"></a><code><span><span class="keyword">val</span> recv : <span><a href="class-datagram_socket/index.html">datagram_socket</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Cstruct</span>.t <span class="arrow">&#45;&gt;</span></span> <a href="Sockaddr/index.html#type-datagram">Sockaddr.datagram</a> * int</span></code></div><div class="spec-doc"><p><code>recv sock buf</code> receives data from the socket <code>sock</code> putting it in <code>buf</code>. The number of bytes received is returned along with the sender address and port. If the <code>buf</code> is too small then excess bytes may be discarded depending on the type of the socket the message is received from.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-close" class="anchored"><a href="#val-close" class="anchor"></a><code><span><span class="keyword">val</span> close : <span><a href="class-socket/index.html">socket</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Closing</p><p><code>close t</code> marks the socket as closed. It can no longer be used after this.</p></div></div></div></body></html>