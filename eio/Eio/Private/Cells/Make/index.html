<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Make (eio.Eio.Private.Cells.Make)</title><link rel="stylesheet" href="../../../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../../index.html">eio</a> &#x00BB; <a href="../../../index.html">Eio</a> &#x00BB; <a href="../../index.html">Private</a> &#x00BB; <a href="../index.html">Cells</a> &#x00BB; Make</nav><header class="odoc-preamble"><h1>Module <code><span>Cells.Make</span></code></h1></header><nav class="odoc-toc"><ul><li><a href="#parameters">Parameters</a></li><li><a href="#signature">Signature</a></li></ul></nav><div class="odoc-content"><h2 id="parameters"><a href="#parameters" class="anchor"></a>Parameters</h2><div class="odoc-spec"><div class="spec parameter anchored" id="argument-1-Cell"><a href="#argument-1-Cell" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="argument-1-Cell/index.html">Cell</a></span><span> : <a href="../module-type-CELL/index.html">CELL</a></span></code></div></div><h2 id="signature"><a href="#signature" class="anchor"></a>Signature</h2><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a t</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-segment"><a href="#type-segment" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a segment</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make"><a href="#val-make" class="anchor"></a><code><span><span class="keyword">val</span> make : <span>unit <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>make ()</code> is a fresh sequence of cells.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-next_suspend"><a href="#val-next_suspend" class="anchor"></a><code><span><span class="keyword">val</span> next_suspend : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-segment">segment</a></span> * <span><span><span class="type-var">'a</span> <a href="argument-1-Cell/index.html#type-t">Cell.t</a></span> <span class="xref-unresolved">Stdlib</span>.Atomic.t</span></span></code></div><div class="spec-doc"><p><code>next_suspend t</code> atomically returns the next suspend cell and its segment.</p><p>If multiple domains call this at the same time, they will each get a different location.</p><p>The cell might or might not have already been filled in by a resumer. You need to handle both cases (typically by using <code>Atomic</code>.compare_and_set).</p><p>The segment can be used with <a href="#val-cancel_cell"><code>cancel_cell</code></a>.</p><p>This function is lock-free and is safe to call even from a signal handler or GC finalizer.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-next_resume"><a href="#val-next_resume" class="anchor"></a><code><span><span class="keyword">val</span> next_resume : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="argument-1-Cell/index.html#type-t">Cell.t</a></span> <span class="xref-unresolved">Stdlib</span>.Atomic.t</span></span></code></div><div class="spec-doc"><p><code>next_resume t</code> atomically returns the next resume cell.</p><p>If multiple domains call this at the same time, they will each get a different cell.</p><p>The cell might or might not contain a request from a suspender that got there first. You need to handle both cases (typically by using <code>Atomic</code>.compare_and_set).</p><p>Note: cancelled cells may or may not be skipped (you need to handle the case of the cell you get being cancelled before you can write to it, but you also can't rely on seeing every cancelled cell, as cancelled segments may be deleted).</p><p>This function is lock-free and is safe to call even from a signal handler or GC finalizer.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-resume_all"><a href="#val-resume_all" class="anchor"></a><code><span><span class="keyword">val</span> resume_all : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span><span><span class="type-var">'a</span> <a href="argument-1-Cell/index.html#type-t">Cell.t</a></span> <span class="xref-unresolved">Stdlib</span>.Atomic.t</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>resume_all t f</code> advances the resume position to the current suspend position, then calls <code>f cell</code> on each cell advanced over.</p><p>Note: as with <a href="#val-next_resume"><code>next_resume</code></a>, <code>f</code> may be called for some cancelled cells but not others.</p><p><code>f</code> must not raise an exception (if it does, it will not be called on the remaining cells).</p><p>If the resume position is ahead of the suspend position, then calling this function does nothing.</p><p>This function is lock-free and is safe to call even from a signal handler or GC finalizer.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-cancel_cell"><a href="#val-cancel_cell" class="anchor"></a><code><span><span class="keyword">val</span> cancel_cell : <span><span><span class="type-var">'a</span> <a href="#type-segment">segment</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>cancel_cell segment</code> increments the segment's count of the number of cancelled cells.</p><p>Once all cells are cancelled it may be possible to discard the whole segment. This avoids leaking memory if a user keeps suspending and then cancelling.</p><p>You must not call this more than once per cell.</p><p>This function is lock-free and is safe to call even from a signal handler or GC finalizer.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-validate"><a href="#val-validate" class="anchor"></a><code><span><span class="keyword">val</span> validate : <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>validate t</code> checks that <code>t</code> is in a valid state, assuming there are no operations currently in progress.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-dump"><a href="#val-dump" class="anchor"></a><code><span><span class="keyword">val</span> dump : <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="xref-unresolved">Fmt</span>.t</span></span></code></div><div class="spec-doc"><p><code>dump</code> outputs the internal state of a <code>_ t</code>, for debugging.</p></div></div></div></body></html>