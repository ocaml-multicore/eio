<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Net (eio.Eio_unix.Net)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">eio</a> &#x00BB; <a href="../index.html">Eio_unix</a> &#x00BB; Net</nav><header class="odoc-preamble"><h1>Module <code><span>Eio_unix.Net</span></code></h1><p>Extended network API with support for file descriptors.</p></header><nav class="odoc-toc"><ul><li><a href="#types">Types</a></li><li><a href="#passing-file-descriptors">Passing file descriptors</a></li><li><a href="#unix-address-conversions">Unix address conversions</a></li><li><a href="#creating-or-importing-sockets">Creating or importing sockets</a></li><li><a href="#private-api-for-backends">Private API for backends</a></li></ul></nav><div class="odoc-content"><h3 id="types"><a href="#types" class="anchor"></a>Types</h3><p>These extend the types in <a href="../../Eio/Net/index.html"><code>Eio.Net</code></a> with support for file descriptors.</p><div class="odoc-spec"><div class="spec type anchored" id="type-stream_socket_ty"><a href="#type-stream_socket_ty" class="anchor"></a><code><span><span class="keyword">type</span> stream_socket_ty</span><span> = <span><span>[ `Generic <span>| `Unix</span> ]</span> <a href="../../Eio/Net/index.html#type-stream_socket_ty">Eio.Net.stream_socket_ty</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-datagram_socket_ty"><a href="#type-datagram_socket_ty" class="anchor"></a><code><span><span class="keyword">type</span> datagram_socket_ty</span><span> = <span><span>[ `Generic <span>| `Unix</span> ]</span> <a href="../../Eio/Net/index.html#type-datagram_socket_ty">Eio.Net.datagram_socket_ty</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-listening_socket_ty"><a href="#type-listening_socket_ty" class="anchor"></a><code><span><span class="keyword">type</span> listening_socket_ty</span><span> = <span><span>[ `Generic <span>| `Unix</span> ]</span> <a href="../../Eio/Net/index.html#type-listening_socket_ty">Eio.Net.listening_socket_ty</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-stream_socket"><a href="#type-stream_socket" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a stream_socket</span></span><span> = <span><span>[&gt; <a href="#type-stream_socket_ty">stream_socket_ty</a> ]</span> <span class="keyword">as</span> 'a <a href="../../Eio/Std/index.html#type-r">Eio.Std.r</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-datagram_socket"><a href="#type-datagram_socket" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a datagram_socket</span></span><span> = <span><span>[&gt; <a href="#type-datagram_socket_ty">datagram_socket_ty</a> ]</span> <span class="keyword">as</span> 'a <a href="../../Eio/Std/index.html#type-r">Eio.Std.r</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-listening_socket"><a href="#type-listening_socket" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a listening_socket</span></span><span> = <span><span>[&gt; <a href="#type-listening_socket_ty">listening_socket_ty</a> ]</span> <span class="keyword">as</span> 'a <a href="../../Eio/Std/index.html#type-r">Eio.Std.r</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span><span> = <span><span><span>[ `Generic <span>| `Unix</span> ]</span> <a href="../../Eio/Net/index.html#type-ty">Eio.Net.ty</a></span> <a href="../../Eio/Std/index.html#type-r">Eio.Std.r</a></span></span></code></div></div><h3 id="passing-file-descriptors"><a href="#passing-file-descriptors" class="anchor"></a>Passing file descriptors</h3><div class="odoc-spec"><div class="spec value anchored" id="val-send_msg"><a href="#val-send_msg" class="anchor"></a><code><span><span class="keyword">val</span> send_msg : 
  <span><span><span>[&gt; <span>`Platform of <span>[&gt; `Unix ]</span></span> <span>| `Socket</span> <span>| `Stream</span> ]</span> <a href="../../Eio/Std/index.html#type-r">Eio.Std.r</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?fds</span>:<span><a href="../Fd/index.html#type-t">Fd.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="xref-unresolved">Cstruct</span>.t list</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Like <a href="../../Eio/Flow/index.html#val-write"><code>Eio.Flow.write</code></a>, but allows passing file descriptors (for Unix-domain sockets).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-recv_msg_with_fds"><a href="#val-recv_msg_with_fds" class="anchor"></a><code><span><span class="keyword">val</span> recv_msg_with_fds : 
  <span><span><span>[&gt; <span>`Platform of <span>[&gt; `Unix ]</span></span> <span>| `Socket</span> <span>| `Stream</span> ]</span> <a href="../../Eio/Std/index.html#type-r">Eio.Std.r</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">sw</span>:<a href="../../Eio/Switch/index.html#type-t">Eio.Std.Switch.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">max_fds</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="xref-unresolved">Cstruct</span>.t list</span> <span class="arrow">&#45;&gt;</span></span>
  int * <span><a href="../Fd/index.html#type-t">Fd.t</a> list</span></span></code></div><div class="spec-doc"><p>Like <a href="../../Eio/Flow/index.html#val-single_read"><code>Eio.Flow.single_read</code></a>, but also allows receiving file descriptors (for Unix-domain sockets).</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">max_fds</span> <p>The maximum number of file descriptors to accept (additional ones will be closed).</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fd"><a href="#val-fd" class="anchor"></a><code><span><span class="keyword">val</span> fd : <span><span><span>[&gt; <span>`Platform of <span>[&gt; `Unix ]</span></span> <span>| `Socket</span> ]</span> <a href="../../Eio/Std/index.html#type-r">Eio.Std.r</a></span> <span class="arrow">&#45;&gt;</span></span> <a href="../Fd/index.html#type-t">Fd.t</a></span></code></div><div class="spec-doc"><p><code>fd socket</code> is the underlying FD of <code>socket</code>.</p></div></div><h3 id="unix-address-conversions"><a href="#unix-address-conversions" class="anchor"></a>Unix address conversions</h3><p>Note: OCaml's <code>Unix.sockaddr</code> type considers e.g. TCP port 80 and UDP port 80 to be the same thing, whereas Eio regards them as separate addresses that just happen to have the same representation (a host address and a port number), so we have separate &quot;of_unix&quot; functions for each.</p><div class="odoc-spec"><div class="spec value anchored" id="val-sockaddr_to_unix"><a href="#val-sockaddr_to_unix" class="anchor"></a><code><span><span class="keyword">val</span> sockaddr_to_unix : 
  <span><span>[&lt; <a href="../../Eio/Net/Sockaddr/index.html#type-stream">Eio.Net.Sockaddr.stream</a> <span>| <a href="../../Eio/Net/Sockaddr/index.html#type-datagram">Eio.Net.Sockaddr.datagram</a></span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Unix</span>.sockaddr</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sockaddr_of_unix_stream"><a href="#val-sockaddr_of_unix_stream" class="anchor"></a><code><span><span class="keyword">val</span> sockaddr_of_unix_stream : <span><span class="xref-unresolved">Unix</span>.sockaddr <span class="arrow">&#45;&gt;</span></span> <a href="../../Eio/Net/Sockaddr/index.html#type-stream">Eio.Net.Sockaddr.stream</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sockaddr_of_unix_datagram"><a href="#val-sockaddr_of_unix_datagram" class="anchor"></a><code><span><span class="keyword">val</span> sockaddr_of_unix_datagram : <span><span class="xref-unresolved">Unix</span>.sockaddr <span class="arrow">&#45;&gt;</span></span> <a href="../../Eio/Net/Sockaddr/index.html#type-datagram">Eio.Net.Sockaddr.datagram</a></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Ipaddr"><a href="#module-Ipaddr" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Ipaddr/index.html">Ipaddr</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Convert between Eio.Net.Ipaddr and Unix.inet_addr.</p></div></div><h3 id="creating-or-importing-sockets"><a href="#creating-or-importing-sockets" class="anchor"></a>Creating or importing sockets</h3><div class="odoc-spec"><div class="spec value anchored" id="val-import_socket_stream"><a href="#val-import_socket_stream" class="anchor"></a><code><span><span class="keyword">val</span> import_socket_stream : 
  <span><span class="label">sw</span>:<a href="../../Eio/Switch/index.html#type-t">Eio.Std.Switch.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">close_unix</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span>
  <span><span>[ `Unix_fd <span>| <a href="#type-stream_socket_ty">stream_socket_ty</a></span> ]</span> <a href="../../Eio/Std/index.html#type-r">Eio.Std.r</a></span></span></code></div><div class="spec-doc"><p><code>import_socket_stream ~sw ~close_unix fd</code> is an Eio flow that uses <code>fd</code>.</p><p>It can be cast to e.g. <a href="../index.html#type-source"><code>source</code></a> for a one-way flow. The socket object will be closed when <code>sw</code> finishes.</p><p>The <code>close_unix</code> and <code>sw</code> arguments are passed to <a href="../Fd/index.html#val-of_unix"><code>Fd.of_unix</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-import_socket_listening"><a href="#val-import_socket_listening" class="anchor"></a><code><span><span class="keyword">val</span> import_socket_listening : 
  <span><span class="label">sw</span>:<a href="../../Eio/Switch/index.html#type-t">Eio.Std.Switch.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">close_unix</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span>
  <span><span>[ `Unix_fd <span>| <a href="#type-listening_socket_ty">listening_socket_ty</a></span> ]</span> <a href="../../Eio/Std/index.html#type-r">Eio.Std.r</a></span></span></code></div><div class="spec-doc"><p><code>import_socket_listening ~sw ~close_unix fd</code> is an Eio listening socket that uses <code>fd</code>.</p><p>The socket object will be closed when <code>sw</code> finishes.</p><p>The <code>close_unix</code> and <code>sw</code> arguments are passed to <a href="../Fd/index.html#val-of_unix"><code>Fd.of_unix</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-import_socket_datagram"><a href="#val-import_socket_datagram" class="anchor"></a><code><span><span class="keyword">val</span> import_socket_datagram : 
  <span><span class="label">sw</span>:<a href="../../Eio/Switch/index.html#type-t">Eio.Std.Switch.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">close_unix</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span>
  <span><span>[ `Unix_fd <span>| <a href="#type-datagram_socket_ty">datagram_socket_ty</a></span> ]</span> <a href="../../Eio/Std/index.html#type-r">Eio.Std.r</a></span></span></code></div><div class="spec-doc"><p><code>import_socket_datagram ~sw ~close_unix fd</code> is an Eio datagram socket that uses <code>fd</code>.</p><p>The socket object will be closed when <code>sw</code> finishes.</p><p>The <code>close_unix</code> and <code>sw</code> arguments are passed to <a href="../Fd/index.html#val-of_unix"><code>Fd.of_unix</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-socketpair_stream"><a href="#val-socketpair_stream" class="anchor"></a><code><span><span class="keyword">val</span> socketpair_stream : 
  <span><span class="label">sw</span>:<a href="../../Eio/Switch/index.html#type-t">Eio.Std.Switch.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?domain</span>:<span class="xref-unresolved">Unix</span>.socket_domain <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?protocol</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span><span>[ `Unix_fd <span>| <a href="#type-stream_socket_ty">stream_socket_ty</a></span> ]</span> <a href="../../Eio/Std/index.html#type-r">Eio.Std.r</a></span>
  * <span><span>[ `Unix_fd <span>| <a href="#type-stream_socket_ty">stream_socket_ty</a></span> ]</span> <a href="../../Eio/Std/index.html#type-r">Eio.Std.r</a></span></span></code></div><div class="spec-doc"><p><code>socketpair_stream ~sw ()</code> returns a connected pair of flows, such that writes to one can be read by the other.</p><p>This creates OS-level resources using <code>socketpair(2)</code>. Note that, like all FDs created by Eio, they are both marked as close-on-exec by default.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-socketpair_datagram"><a href="#val-socketpair_datagram" class="anchor"></a><code><span><span class="keyword">val</span> socketpair_datagram : 
  <span><span class="label">sw</span>:<a href="../../Eio/Switch/index.html#type-t">Eio.Std.Switch.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?domain</span>:<span class="xref-unresolved">Unix</span>.socket_domain <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?protocol</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span><span>[ `Unix_fd <span>| <a href="#type-datagram_socket_ty">datagram_socket_ty</a></span> ]</span> <a href="../../Eio/Std/index.html#type-r">Eio.Std.r</a></span>
  * <span><span>[ `Unix_fd <span>| <a href="#type-datagram_socket_ty">datagram_socket_ty</a></span> ]</span> <a href="../../Eio/Std/index.html#type-r">Eio.Std.r</a></span></span></code></div><div class="spec-doc"><p><code>socketpair_datagram ~sw ()</code> returns a connected pair of flows, such that writes to one can be read by the other.</p><p>This creates OS-level resources using <code>socketpair(2)</code>. Note that, like all FDs created by Eio, they are both marked as close-on-exec by default.</p></div></div><h3 id="private-api-for-backends"><a href="#private-api-for-backends" class="anchor"></a>Private API for backends</h3><div class="odoc-spec"><div class="spec value anchored" id="val-getnameinfo"><a href="#val-getnameinfo" class="anchor"></a><code><span><span class="keyword">val</span> getnameinfo : <span><a href="../../Eio/Net/Sockaddr/index.html#type-t">Eio.Net.Sockaddr.t</a> <span class="arrow">&#45;&gt;</span></span> string * string</span></code></div><div class="spec-doc"><p><code>getnameinfo sockaddr</code> returns domain name and service for <code>sockaddr</code>.</p></div></div><div class="odoc-spec"><div class="spec type extension anchored" id="extension-decl-Import_socket_stream"><a href="#extension-decl-Import_socket_stream" class="anchor"></a><code><span><span class="keyword">type</span> <span class="xref-unresolved">Stdlib</span>.Effect.t += </span></code><ol><li id="extension-Import_socket_stream" class="def variant extension anchored"><a href="#extension-Import_socket_stream" class="anchor"></a><code><span>| </span><span><span class="extension">Import_socket_stream</span> : <a href="../../Eio/Switch/index.html#type-t">Eio.Std.Switch.t</a>
  * bool
  * <span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span> <span><span><span>[ `Unix_fd <span>| <a href="#type-stream_socket_ty">stream_socket_ty</a></span> ]</span> <a href="../../Eio/Std/index.html#type-r">Eio.Std.r</a></span>
                         <span class="xref-unresolved">Stdlib</span>.Effect.t</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>See <a href="#val-import_socket_stream"><code>import_socket_stream</code></a></p><span class="comment-delim">*)</span></div></li><li id="extension-Import_socket_listening" class="def variant extension anchored"><a href="#extension-Import_socket_listening" class="anchor"></a><code><span>| </span><span><span class="extension">Import_socket_listening</span> : <a href="../../Eio/Switch/index.html#type-t">Eio.Std.Switch.t</a>
  * bool
  * <span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span> <span><span><span>[ `Unix_fd <span>| <a href="#type-listening_socket_ty">listening_socket_ty</a></span> ]</span> <a href="../../Eio/Std/index.html#type-r">Eio.Std.r</a></span>
                         <span class="xref-unresolved">Stdlib</span>.Effect.t</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>See <a href="#val-import_socket_listening"><code>import_socket_listening</code></a></p><span class="comment-delim">*)</span></div></li><li id="extension-Import_socket_datagram" class="def variant extension anchored"><a href="#extension-Import_socket_datagram" class="anchor"></a><code><span>| </span><span><span class="extension">Import_socket_datagram</span> : <a href="../../Eio/Switch/index.html#type-t">Eio.Std.Switch.t</a>
  * bool
  * <span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span> <span><span><span>[ `Unix_fd <span>| <a href="#type-datagram_socket_ty">datagram_socket_ty</a></span> ]</span> <a href="../../Eio/Std/index.html#type-r">Eio.Std.r</a></span>
                         <span class="xref-unresolved">Stdlib</span>.Effect.t</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>See <a href="#val-import_socket_datagram"><code>import_socket_datagram</code></a></p><span class="comment-delim">*)</span></div></li><li id="extension-Socketpair_stream" class="def variant extension anchored"><a href="#extension-Socketpair_stream" class="anchor"></a><code><span>| </span><span><span class="extension">Socketpair_stream</span> : <a href="../../Eio/Switch/index.html#type-t">Eio.Switch.t</a>
  * <span class="xref-unresolved">Unix</span>.socket_domain
  * int <span class="arrow">&#45;&gt;</span> <span><span>(<span><span>[ `Unix_fd <span>| <a href="#type-stream_socket_ty">stream_socket_ty</a></span> ]</span> <a href="../../Eio/Std/index.html#type-r">Eio.Std.r</a></span>
            * <span><span>[ `Unix_fd <span>| <a href="#type-stream_socket_ty">stream_socket_ty</a></span> ]</span> <a href="../../Eio/Std/index.html#type-r">Eio.Std.r</a></span>)</span>
             <span class="xref-unresolved">Stdlib</span>.Effect.t</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>See <a href="#val-socketpair_stream"><code>socketpair_stream</code></a></p><span class="comment-delim">*)</span></div></li><li id="extension-Socketpair_datagram" class="def variant extension anchored"><a href="#extension-Socketpair_datagram" class="anchor"></a><code><span>| </span><span><span class="extension">Socketpair_datagram</span> : <a href="../../Eio/Switch/index.html#type-t">Eio.Switch.t</a>
  * <span class="xref-unresolved">Unix</span>.socket_domain
  * int <span class="arrow">&#45;&gt;</span> <span><span>(<span><span>[ `Unix_fd <span>| <a href="#type-datagram_socket_ty">datagram_socket_ty</a></span> ]</span> <a href="../../Eio/Std/index.html#type-r">Eio.Std.r</a></span>
            * <span><span>[ `Unix_fd <span>| <a href="#type-datagram_socket_ty">datagram_socket_ty</a></span> ]</span> <a href="../../Eio/Std/index.html#type-r">Eio.Std.r</a></span>)</span>
             <span class="xref-unresolved">Stdlib</span>.Effect.t</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>See <a href="#val-socketpair_datagram"><code>socketpair_datagram</code></a></p><span class="comment-delim">*)</span></div></li></ol></div></div></div></body></html>
