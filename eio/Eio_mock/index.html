<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Eio_mock (eio.Eio_mock)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">eio</a> &#x00BB; Eio_mock</nav><header class="odoc-preamble"><h1>Module <code><span>Eio_mock</span></code></h1><p>Mocks for testing.</p><p>When testing an Eio program it is often convenient to use mock resources rather than real OS-provided ones. This allows precise control over the test, such as adding delays or simulated faults. You can always just implement the various Eio types directly, but this module provides some convenient pre-built mocks, and some helpers for creating your own mocks.</p><p>Mocks typically use <a href="../Eio/index.html#val-traceln"><code>Eio.traceln</code></a> to record how they were used. This output can be recorded and compared against a known-good copy using e.g. <a href="https://github.com/realworldocaml/mdx">ocaml-mdx</a>.</p><p>Mocks may require configuration. For example, a source flow needs to know what data to return when the application reads from it. This can be done using the various <code>on_*</code> functions. For example:</p><pre><code>let stdin = Eio_mock.Flow.make &quot;stdin&quot; in
let stdout = Eio_mock.Flow.make &quot;stdout&quot; in
Eio_mock.Flow.on_read stdin [
  `Return &quot;chunk1&quot;;
  `Return &quot;chunk2&quot;;
  `Raise End_of_file
];
Eio.Flow.copy stdin stdout</code></pre><p>This will produce:</p><pre><code>+stdin: read &quot;chunk1&quot;
+stdout: wrote &quot;chunk1&quot;
+stdin: read &quot;chunk2&quot;
+stdout: wrote &quot;chunk2&quot;</code></pre></header><nav class="odoc-toc"><ul><li><a href="#configuration">Configuration</a></li><li><a href="#pre-defined-mocks">Pre-defined mocks</a></li></ul></nav><div class="odoc-content"><h3 id="configuration"><a href="#configuration" class="anchor"></a>Configuration</h3><div class="odoc-spec"><div class="spec module" id="module-Action" class="anchored"><a href="#module-Action" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Action/index.html">Action</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Actions that can be performed by mock handlers.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Handler" class="anchored"><a href="#module-Handler" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Handler/index.html">Handler</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Control how a mock responds.</p></div></div><h3 id="pre-defined-mocks"><a href="#pre-defined-mocks" class="anchor"></a>Pre-defined mocks</h3><div class="odoc-spec"><div class="spec module" id="module-Flow" class="anchored"><a href="#module-Flow" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Flow/index.html">Flow</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Mock <a href="../Eio/Flow/index.html"><code>Eio.Flow</code></a> sources and sinks.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Net" class="anchored"><a href="#module-Net" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Net/index.html">Net</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Mock <a href="../Eio/Net/index.html"><code>Eio.Net</code></a> networks and sockets.</p></div></div></div></body></html>